<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Slotkeeper</title>
</head>
<body>
    {% if username %}
        <h2>Welcome, {{ username }}!</h2>
        <p><a href="/add_device">Add new device</a></p>
        <p><a href="/logout">Log out</a></p>

        <h3>Registered Test Devices</h3>
        <form method="get" action="/">
            <input type="text" name="q" placeholder="Search devices" value="{{ query or '' }}">
            <input type="submit" value="Search">
        </form>
        <ul>
            {% for entry in devices %}
                <li>
                    <strong>{{ entry.device.name }}</strong> â€” {{ entry.device.description or 'No description' }}
                    {% if entry.reservation %}
                        <div>
                            <em>
                                Reserved by {{ entry.reservation.username }} until 
                                {{ entry.reservation.reserved_until | int | datetimeformat }}
                            </em>
                        </div>
                        {% if entry.user_owned %}
                            <form method="post" action="/cancel_reservation/{{ entry.reservation.id }}" style="display:inline;">
                                <button type="submit">Release</button>
                            </form>
                        {% endif %}
                    {% else %}
                        [<a href="/reserve/{{ entry.device.id }}">Reserve</a>]
                    {% endif %}
                    [<a href="/edit_device/{{ entry.device.id }}">Edit</a>]
                    <form method="post" action="/delete_device/{{ entry.device.id }}" style="display:inline;">
                        <button type="submit">Delete</button>
                    </form>
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <h2>You are not logged in.</h2>
        <p><a href="/login">Log in</a> or <a href="/register">Create account</a></p>
    {% endif %}
</body>
</html>
